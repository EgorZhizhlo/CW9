<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Заявки — Admin ReHub</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/static/admin/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/static/admin/css/footer.css}">
    <link rel="stylesheet" th:href="@{/static/admin/css/admin.css}">
</head>

<body>

<!-- NAVBAR -->
<div th:replace="admin/layout/navbar :: admin_navbar"></div>


<div class="content-wrapper">

    <div class="container py-5">

        <!-- Header -->
        <h1 class="fw-bold mb-4">Заявки</h1>

        <div class="card shadow-sm border-0">
            <div class="card-body p-0">

                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                    <tr>
                        <th style="width: 60px;">ID</th>
                        <th>Имя</th>
                        <th>Телефон</th>
                        <th>Сообщение</th>
                        <th>Дата</th>
                        <th>Статус</th>
                        <th style="width: 150px;" class="text-end">Действия</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="r : ${requests}">
                        <td th:text="${r.id}"></td>

                        <td>
                            <strong th:text="${r.name}"></strong>
                        </td>

                        <td>
                            <a th:href="'tel:' + ${r.phone}" class="text-decoration-none"
                               th:text="${r.phone}"></a>
                        </td>

                        <td th:text="${#strings.abbreviate(r.message, 60)}"></td>

                        <td th:text="${#temporals.format(r.createdAt, 'dd.MM.yyyy HH:mm')}"></td>

                        <!-- STATUS -->
                        <td>
                                <span class="badge"
                                      th:classappend="${r.status.name() == 'NEW' ? ' bg-warning text-dark' : ' bg-success'}"
                                      th:text="${r.status == T(com.rehub.model.Request.Status).NEW ? 'Новая' : 'Обработано'}">
                                </span>
                        </td>

                        <!-- ACTIONS -->
                        <td class="text-end">

                            <!-- Process -->
                            <form th:if="${r.status.name() == 'NEW'}"
                                  th:action="@{'/admin/requests/process/' + ${r.id}}"
                                  method="post"
                                  style="display:inline-block;">
                                <button class="btn btn-success btn-sm">
                                    <i class="bi bi-check-lg"></i> Готово
                                </button>
                            </form>

                            <!-- Delete -->
                            <a class="btn btn-outline-danger btn-sm ms-2"
                               th:href="@{'/admin/requests/delete/' + ${r.id}}"
                               onclick="return confirm('Удалить заявку?');">
                                <i class="bi bi-trash"></i>
                            </a>

                        </td>

                    </tr>
                    </tbody>

                </table>

            </div>
        </div>

    </div>

</div>


<!-- FOOTER -->
<div th:replace="admin/layout/footer :: admin_footer"></div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
