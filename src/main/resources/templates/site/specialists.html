<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Специалисты — ReHub</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/static/site/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/static/site/css/footer.css}">
    <link rel="stylesheet" th:href="@{/static/site/css/site.css}">
</head>

<body>

<!-- NAVBAR -->
<div th:replace="site/layout/navbar :: navbar"></div>


<div class="content-wrapper">

    <section class="py-5 bg-light border-bottom">
        <div class="container text-center">

            <h1 class="fw-bold mb-3">Наши специалисты</h1>

            <p class="lead text-secondary mx-auto" style="max-width: 700px;">
                Профессиональная команда врачей, психологов и инструкторов,
                готовая помочь каждому пациенту на пути к восстановлению.
            </p>

        </div>
    </section>


    <section class="py-5">
        <div class="container">

            <div class="row g-4">

                <div class="col-md-4" th:each="sp : ${specialists}">
                    <div class="card shadow-sm h-100 text-center">

                        <div class="p-3">
                            <img th:src="${sp.photoUrl != null ? sp.photoUrl : 'https://via.placeholder.com/300x200'}"
                                 class="img-fluid rounded"
                                 style="height: 240px; object-fit: cover;"
                                 alt="Фото специалиста">
                        </div>

                        <div class="card-body">

                            <h5 class="card-title fw-bold"
                                th:text="${sp.fullName != null ? sp.fullName : sp.username}"></h5>

                            <p class="text-primary fw-semibold" th:text="${sp.position}"></p>

                            <p class="card-text text-secondary"
                               th:text="${#strings.abbreviate(sp.description, 140)}"></p>

                            <!-- кнопка записи -->
                            <button class="btn btn-primary mt-2"
                                    data-bs-toggle="modal"
                                    data-bs-target="#appointmentModal"
                                    th:attr="data-doctor-id=${sp.id}, data-doctor-name=${sp.fullName}">
                                Записаться
                            </button>

                        </div>

                    </div>
                </div>

            </div>

        </div>
    </section>

</div>


<!-- FOOTER -->
<div th:replace="site/layout/footer :: footer"></div>

<!-- MODAL -->
<div class="modal fade" id="appointmentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <form method="post" action="/appointments/create">

                <input type="hidden" name="doctorId" id="doctorId">

                <div class="modal-header">
                    <h5 class="modal-title">
                        Запись к специалисту
                        <span id="doctorName" class="text-primary"></span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <div class="mb-3">
                        <label class="form-label">Дата и время</label>
                        <input type="datetime-local" class="form-control"
                               name="appointmentDateTime" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Сообщение (необязательно)</label>
                        <textarea class="form-control" name="message" rows="3"></textarea>
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-primary">Записаться</button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Отмена</button>
                </div>

            </form>

        </div>
    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("appointmentModal");
        modal.addEventListener("show.bs.modal", (event) => {

            const button = event.relatedTarget;

            const doctorId = button.getAttribute("data-doctor-id");
            const doctorName = button.getAttribute("data-doctor-name");

            document.getElementById("doctorId").value = doctorId;
            document.getElementById("doctorName").textContent = doctorName ? ("— " + doctorName) : "";
        });
    });
</script>



<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
